# Spack environment file for a serial statically linked CP2K binary

spack:
  concretizer:
    unify: true

  config:
    install_tree:
      padded_length: 128
      root: /opt/spack

  modules:
    prefix_inspections:
      ./lib:
        - LD_LIBRARY_PATH
      ./lib64:
        - LD_LIBRARY_PATH

  packages:
    all:
      buildable: true
      prefer:
        - "~cuda"
        - "~mpi"
        - "~mpi_f08"
        - "+openmp"
        - "+pic"
        - "~rocm"
    #   - "~shared" this does not work because of gettext
        - "+static"
        - "build_system=cmake"
        - "build_type=Release"

    # ScaLAPACK, LAPACK, BLAS
    blas:
      require:
        - openblas

    lapack:
      require:
        - openblas

    libxsmm:
      require:
        - "blas=default"

    openblas:
      require:
        - "+fortran"
        - "threads=openmp"

    # Libraries needed by CP2K
    dbcsr:
      require:
        - "~examples"
        - "+openmp"
        - "~shared"
        - "smm=libxsmm"

    fftw:
      require:
        - "+openmp"
        - "~shared"

    hdf5:
      require:
        - "+fortran"
        - "~shared"

    libint:
      require:
        - "+fortran"
        - "~shared"
        - "tune=cp2k-lmax-5"

    libxc:
      require:
        - "+kxc"
        - "~shared"

    spglib:
      require:
        - "~shared"

  specs:
    # Build tools
    - "cmake@3.27:"
    - "gcc@10:"
    - "gmake@4.2:"
    - "ninja@1.10:"
    - "python@3.11:"
    # CP2K
    - "dbcsr@2.9.1"
    - "dftd4@3.7.0"
    - "fftw@3.3.10"
#   - "hdf5@1.14.6"
    - "libint@2.11.1"
    - "libvori@220621"
    - "libxc@7.0.0"
    - "libxsmm@1.17-cp2k"
    - "openblas@0.3.31"
    - "pace@2025.12.4"
    - "spglib@2.7.0"
    - "tblite@0.5.0"

  view:
    default:
      root: /opt/spack/view
      exclude:
        # Exclude gcc-runtime to avoid adding a copy of libgomp.so to the view
        - gcc-runtime
